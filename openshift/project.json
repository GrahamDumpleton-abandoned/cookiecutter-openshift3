{
    "kind": "List",
    "apiVersion": "v1",
    "items": [
        {
    "kind": "ImageStream",
    "apiVersion": "v1",
    "metadata": {
        "name": "wagtail",
        "labels": {
            "app": "wagtail"
        }
    }
}

, {
    "kind": "ImageStream",
    "apiVersion": "v1",
    "metadata": {
        "name": "wagtail-s2i",
        "labels": {
            "app": "wagtail"
        }
    },
    "spec": {
        "tags": [
            {

                "name": "latest",

                "from": {
                    "kind": "DockerImage",
                    "name": "grahamdumpleton/warp0-debian8-python27"
                }
            }
        ]
    }
}


        , {
    "kind": "BuildConfig",
    "apiVersion": "v1",
    "metadata": {
        "name": "wagtail",
        "labels": {
            "app": "wagtail"
        }
    },
    "spec": {
        "triggers": [
            {
                "type": "ImageChange",
                "imageChange": {}
            },
            {
                "type": "ConfigChange"
            }
        ],
        "source": {
            "type": "Git",
            "git": {
                "uri": "https://github.com/GrahamDumpleton/wagtail-demo-site.git",
                "ref": "master"
            }
        },
        "strategy": {
            "type": "Source",
            "sourceStrategy": {
                "from": {
                    "kind": "ImageStreamTag",


                    "name": "wagtail-s2i:latest"


                }
            }
        },
        "output": {
            "to": {
                "kind": "ImageStreamTag",
                "name": "wagtail:latest"
            }
        }
    }
}

        , {
    "kind": "DeploymentConfig",
    "apiVersion": "v1",
    "metadata": {
        "name": "wagtail",
        "labels": {
            "app": "wagtail"
        }
    },
    "spec": {
        "triggers": [
            {
                "type": "ImageChange",
                "imageChangeParams": {
                    "automatic": true,
                    "containerNames": [
                        "wagtail"
                    ],
                    "from": {
                        "kind": "ImageStreamTag",
                        "name": "wagtail:latest"
                    }
                }
            },
            {
                "type": "ConfigChange"
            }
        ],
        "replicas": 2,
        "selector": {
            "deploymentconfig": "wagtail"
        },
        "template": {
            "metadata": {
                "labels": {
                    "app": "wagtail",
                    "deploymentconfig": "wagtail"
                }
            },
            "spec": {
                "containers": [
                    {
                        "name": "wagtail",
                        "image": "wagtail:latest",
                        "ports": [
                            {
                                "containerPort": 8080,
                                "protocol": "TCP"
                            }
                        ],
                        "env": [
                            {
                                "name": "OPENSHIFT_LANGUAGE_RUNTIME",
                                "value": "Python"
                            }

                            , {
                                "name": "OPENSHIFT_DATABASE_TYPE",
                                "value": "PostgreSQL"
                            }
                            , {
                                "name": "OPENSHIFT_POSTGRESQL_DB_HOST",
                                "value": "wagtail-db"
                            }
                            , {
                                "name": "OPENSHIFT_POSTGRESQL_DB_PORT",


                                "value": "5432"

                            }
                            , {
                                "name": "OPENSHIFT_POSTGRESQL_DB_USERNAME",
                                "value": "user3TIC"
                            }
                            , {
                                "name": "OPENSHIFT_POSTGRESQL_DB_PASSWORD",
                                "value": "V7z3RHSvdIhYQQAc"
                            }
                            , {
                                "name": "OPENSHIFT_POSTGRESQL_DB_NAME",
                                "value": "wagtail_db"
                            }
                            , {
                                "name": "OPENSHIFT_POSTGRESQL_DB_URL",


                                "value": "postgresql://user3TIC:V7z3RHSvdIhYQQAc@wagtail-db:5432/wagtail_db"

                            }



                            , {
                                "name": "DJANGO_SECRET_KEY",
                                "value": "i0bxVOVi6BEBGn6XcRquEmylFYVEV7gFeeT7bD5XbpHdNGNqKB"
                            }

                            , {
                                "name": "DJANGO_SETTINGS_MODULE",
                                "value": "demo.settings.production"
                            }



                        ]

                        , "resources": {
                          "limits": {
                            "memory": "128Mi"
                          }
                        }


                    }
                ]

            }
        }
    }
}


        , {
    "kind": "Service",
    "apiVersion": "v1",
    "metadata": {
        "name": "wagtail",
        "labels": {
            "app": "wagtail"
        }
    },
    "spec": {
        "ports": [
            {
                "name": "8080-tcp",
                "protocol": "TCP",
                "port": 8080,
                "targetPort": 8080
            }
        ],
        "selector": {
            "deploymentconfig": "wagtail"
        }
    }
}


        , {
    "kind": "Route",
    "apiVersion": "v1",
    "metadata": {
        "name": "wagtail",
        "labels": {
            "app": "wagtail"
        }
    },
    "spec": {
        
        "to": {
            "kind": "Service",
            "name": "wagtail"
        },
        "port": {
            "targetPort": "8080-tcp"
        }
    }
}





        , 
        {
          "kind": "PersistentVolumeClaim",
          "apiVersion": "v1",
          "metadata": {
            "name": "wagtail-db-pvc"
          },
          "spec": {
            "accessModes": [
              "ReadWriteOnce"
            ],
            "resources": {
              "requests": {
                "storage": "512Mi"
              }
            }
          }
        },

        {
            "kind": "DeploymentConfig",
            "apiVersion": "v1",
            "metadata": {
                "name": "wagtail-db",
                "labels": {
                    "db": "wagtail-db"
                }
            },
            "spec": {
                "triggers": [
                    {
                        "type": "ImageChange",
                        "imageChangeParams": {
                            "automatic": true,
                            "containerNames": [
                                "wagtail-db"
                            ],
                            "from": {
                                "kind": "ImageStreamTag",
                                "name": "postgresql:9.4",
                                "namespace": "openshift"
                            }
                        }
                    },
                    {
                        "type": "ConfigChange"
                    }
                ],
                "replicas": 1,
                "selector": {
                    "deploymentconfig": "wagtail-db"
                },
                "template": {
                    "metadata": {
                        "name": "wagtail-db",
                        "labels": {
                            "db": "wagtail-db"
                        }
                    },
                    "spec": {
                        "containers": [
                            {
                                "name": "wagtail-db",
                                "image": "openshift/postgresql",
                                "ports": [
                                    {
                                        "containerPort": 5432,
                                        "protocol": "TCP"
                                    }
                                ],
                                "env": [
                                    {
                                        "name": "POSTGRESQL_USER",
                                        "value": "user3TIC"
                                    },
                                    {
                                        "name": "POSTGRESQL_PASSWORD",
                                        "value": "V7z3RHSvdIhYQQAc"
                                    },
                                    {
                                        "name": "POSTGRESQL_DATABASE",
                                        "value": "wagtail_db"
                                    }
                                ]

                                , "resources": {
                                  "limits": {
                                    "memory": "128Mi"
                                  }
                                }


                                , "volumeMounts": [
                                    {
                                        "name": "wagtail-db-pv",
                                        "mountPath": "/var/lib/pgsql/data"
                                    }
                                ]

                            }
                        ]

                        , "volumes": [
                            {
                                "name": "wagtail-db-pv",
                                "persistentVolumeClaim": {
                                    "claimName": "wagtail-db-pvc"
                                }
                            }
                        ]

                    }
                }
            }
        },
        {
            "kind": "Service",
            "apiVersion": "v1",
            "metadata": {
                "name": "wagtail-db",
                "labels": {
                    "db": "wagtail-db"
                }
            },
            "spec": {
                "ports": [
                    {
                        "name": "postgresql",
                        "protocol": "TCP",
                        "port": 5432,
                        "targetPort": 5432
                    }
                ],
                "selector": {
                    "deploymentconfig": "wagtail-db"
                }
            }
        }



    ]
}
